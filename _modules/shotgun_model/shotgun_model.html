

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>shotgun_model.shotgun_model &mdash; tk-framework-shotgunutils v5.10.2 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
    <a href='https://help.autodesk.com/view/SGDEV/ENU/'>
    
        <img style='width: 191px;
                height: 60px;
                margin: 2px;
                border-radius: 0px;
                padding: 0px;'
            src='../../_static/logo@2x.png'/>
    
    </a>
    

          
          
          <a href="../../index.html" class="icon icon-home">
            tk-framework-shotgunutils
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
    
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../shotgun_model.html">Shotgun Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../shotgun_hierarchy_model.html">Shotgun Hierarchy Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../shotgun_data.html">Shotgun Asynchronous Data Retriever</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../task_manager.html">Background Task Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../settings.html">Shotgun Toolkit Qt Settings Wrapper</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../shotgun_globals.html">Shotgun Globals Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../external_config.html">External Configuration Management</a></li>
</ul>


    <a href='genindex.html'>Alphabetic Index</a>

    <div style='margin-top: 50px;
                margin-left: 10px;
                margin-right: 10px;
                padding: 10px;
                color: #b3b3b3;
                font-size: 70%;
                border-radius: 3px;
                background-color: #444;
                line-height: 18px;
                '>
    <style>
        a.custom_post_menu { display: inline;
                             padding: 0px;
                             text-decoration: underline; }
    </style>

    <b>tk-framework-shotgunutils</b> v5.10.2.<br>
    
        This documentation is part of the Flow Production Tracking.
    
    For more information, please visit
    <a class=custom_post_menu href='https://help.autodesk.com/view/SGDEV/ENU/'>The Flow Production Tracking developer portal.</a>.
    The code associated with this documentation can be found
    <a class=custom_post_menu href='https://github.com/shotgunsoftware/tk-framework-shotgunutils'>here</a>.

    </div>
    <style>
        p.privacy_links { margin: 4px 0px;}
    </style>
    <p class="privacy_links"><a data-opt-in-preferences href="javascript:;">Privacy settings</a></p>
    <p class="privacy_links"><a data-wat-linkname="manage-ccpa-settings-footer-link" href="javascript:;">Do not sell my personal information</a></p>
    <p class="privacy_links"><a href="https://www.autodesk.com/company/legal-notices-trademarks/privacy-statement">Privacy/Cookies</a></p>



        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">tk-framework-shotgunutils</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">shotgun_model.shotgun_model</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for shotgun_model.shotgun_model</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (c) 2016 Shotgun Software Inc.</span>
<span class="c1">#</span>
<span class="c1"># CONFIDENTIAL AND PROPRIETARY</span>
<span class="c1">#</span>
<span class="c1"># This work is provided &quot;AS IS&quot; and subject to the Shotgun Pipeline Toolkit</span>
<span class="c1"># Source Code License included in this distribution package. See LICENSE.</span>
<span class="c1"># By accessing, using, copying or modifying this work you indicate your</span>
<span class="c1"># agreement to the Shotgun Pipeline Toolkit Source Code License. All rights</span>
<span class="c1"># not expressly granted therein are reserved by Shotgun Software Inc.</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">sgtk</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>


<span class="kn">from</span><span class="w"> </span><span class="nn">sgtk.platform.qt</span><span class="w"> </span><span class="kn">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtGui</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.shotgun_standard_item</span><span class="w"> </span><span class="kn">import</span> <span class="n">ShotgunStandardItem</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.shotgun_query_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">ShotgunQueryModel</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.data_handler_find</span><span class="w"> </span><span class="kn">import</span> <span class="n">ShotgunFindDataHandler</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.util</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_sanitized_data</span><span class="p">,</span> <span class="n">get_sg_data</span><span class="p">,</span> <span class="n">sanitize_for_qt_model</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">tank_vendor</span><span class="w"> </span><span class="kn">import</span> <span class="n">sgutils</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">tank_vendor</span><span class="w"> </span><span class="kn">import</span> <span class="n">six</span> <span class="k">as</span> <span class="n">sgutils</span>


<div class="viewcode-block" id="ShotgunModel"><a class="viewcode-back" href="../../shotgun_model.html#shotgun_model.ShotgunModel">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">ShotgunModel</span><span class="p">(</span><span class="n">ShotgunQueryModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Qt Model representing a Shotgun query.</span>

<span class="sd">    This class implements a standard :class:`~PySide.QtCore.QAbstractItemModel`</span>
<span class="sd">    specialized to hold the contents of a particular Shotgun query. It is cached</span>
<span class="sd">    and refreshes its data asynchronously.</span>

<span class="sd">    In order to use this class, you normally subclass it and implement certain key data</span>
<span class="sd">    methods for setting up queries, customizing etc. Then you connect your class to</span>
<span class="sd">    a :class:`~PySide.QtGui.QAbstractItemView` of some sort which will display the result.</span>
<span class="sd">    If you need to do manipulations such as sorting or filtering on the data,</span>
<span class="sd">    connect a proxy model (typically :class:`~PySide.QtGui.QSortFilterProxyModel`)</span>
<span class="sd">    between your class and the view.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Custom model role that holds the associated value</span>
    <span class="n">SG_ASSOCIATED_FIELD_ROLE</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">UserRole</span> <span class="o">+</span> <span class="mi">10</span>

    <span class="c1"># header value for the first column</span>
    <span class="n">FIRST_COLUMN_HEADER</span> <span class="o">=</span> <span class="s2">&quot;Name&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">parent</span><span class="p">,</span>
        <span class="n">download_thumbs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">schema_generation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">bg_load_thumbs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">bg_task_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param parent: Parent object.</span>
<span class="sd">        :type parent: :class:`~PySide.QtGui.QWidget`</span>
<span class="sd">        :param download_thumbs: Boolean to indicate if this model should attempt</span>
<span class="sd">                                to download and process thumbnails for the downloaded data.</span>
<span class="sd">        :param schema_generation: Schema generation number. Advanced parameter. If your</span>
<span class="sd">                                  shotgun model contains logic in subclassed methods</span>
<span class="sd">                                  that modify the shotgun data prior to it being put into</span>
<span class="sd">                                  the cache system that the ShotgunModel maintains, you can</span>
<span class="sd">                                  use this option to ensure that different versions of the code</span>
<span class="sd">                                  access different caches. If you change your custom business logic</span>
<span class="sd">                                  around and update the generation number, both new and old</span>
<span class="sd">                                  versions of the code will work correctly against the cached data.</span>
<span class="sd">        :param bg_load_thumbs: If set to True, thumbnails will be loaded in the background.</span>
<span class="sd">        :param bg_task_manager:  Background task manager to use for any asynchronous work. If</span>
<span class="sd">                                 this is None then a task manager will be created as needed.</span>
<span class="sd">        :type bg_task_manager: :class:`~task_manager.BackgroundTaskManager`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">bg_load_thumbs</span><span class="p">,</span> <span class="n">bg_task_manager</span><span class="p">)</span>

        <span class="c1"># default value so that __repr__ can be used before load_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__entity_type</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__schema_generation</span> <span class="o">=</span> <span class="n">schema_generation</span>

        <span class="c1"># keep track of info for thumbnail download/load</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__download_thumbs</span> <span class="o">=</span> <span class="n">download_thumbs</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        String representation of this instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2"> entity_type:</span><span class="si">%s</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__entity_type</span><span class="p">)</span>

    <span class="c1">########################################################################################</span>
    <span class="c1"># public methods</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">entity_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of entity ids that are part of this model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># note that all of the ids may not be loaded into the actual model</span>
        <span class="c1"># yet so we have to query the data handler for this.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_handler</span><span class="o">.</span><span class="n">get_entity_ids</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_handler</span> <span class="k">else</span> <span class="p">[]</span>

<div class="viewcode-block" id="ShotgunModel.item_from_entity"><a class="viewcode-back" href="../../shotgun_model.html#shotgun_model.ShotgunModel.item_from_entity">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">item_from_entity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a :class:`~PySide.QtGui.QStandardItem` based on</span>
<span class="sd">        entity type and entity id. Returns none if not found.</span>

<span class="sd">        :param entity_type: Shotgun entity type to look for</span>
<span class="sd">        :param entity_id: Shotgun entity id to look for</span>
<span class="sd">        :returns: :class:`~PySide.QtGui.QStandardItem` or None if not found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_debug</span><span class="p">(</span>
            <span class="s2">&quot;Resolving model item for entity </span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">entity_type</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__entity_type</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_debug</span><span class="p">(</span><span class="s2">&quot;...entity type is not part of this model!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">uid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_handler</span><span class="o">.</span><span class="n">get_uid_from_entity_id</span><span class="p">(</span><span class="n">entity_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">uid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># no match in data store</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_debug</span><span class="p">(</span><span class="s2">&quot;...entity id is not part of the data set&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_item_loaded</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span></div>

<div class="viewcode-block" id="ShotgunModel.index_from_entity"><a class="viewcode-back" href="../../shotgun_model.html#shotgun_model.ShotgunModel.index_from_entity">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">index_from_entity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a QModelIndex based on entity type and entity id</span>
<span class="sd">        Returns none if not found.</span>

<span class="sd">        :param entity_type: Shotgun entity type to look for</span>
<span class="sd">        :param entity_id: Shotgun entity id to look for</span>
<span class="sd">        :returns: :class:`~PySide.QtCore.QModelIndex` or None if not found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_from_entity</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexFromItem</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></div>

<div class="viewcode-block" id="ShotgunModel.get_filters"><a class="viewcode-back" href="../../shotgun_model.html#shotgun_model.ShotgunModel.get_filters">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of Shotgun filters representing the given item. This is useful if</span>
<span class="sd">        you are trying to determine how intermediate leaf nodes partition leaf node data.</span>

<span class="sd">        For example, if you have created a hierarchical model for a Shot listing::</span>

<span class="sd">            hierarchy: [sg_sequence, sg_status, code]</span>

<span class="sd">        The Shotgun model will group the data by sequence, then by status, then the leaf</span>
<span class="sd">        nodes will be the shot names. If you execute the get_filters() method on a sequence</span>
<span class="sd">        level tree node, it may return::</span>

<span class="sd">            [ [&#39;sg_sequence&#39;, &#39;is&#39;, {&#39;type&#39;: &#39;Sequence&#39;, &#39;id&#39;: 123, &#39;name&#39;: &#39;foo&#39;}] ]</span>

<span class="sd">        If you execute the get_filters() on a status node in the tree, it may return::</span>

<span class="sd">            [</span>
<span class="sd">              [&#39;sg_sequence&#39;, &#39;is&#39;, {&#39;type&#39;: &#39;Sequence&#39;, &#39;id&#39;: 123, &#39;name&#39;: &#39;foo&#39;}],</span>
<span class="sd">              [&#39;sg_status&#39;, &#39;is&#39;, &#39;ip&#39;]</span>
<span class="sd">            ]</span>

<span class="sd">        :param item: One of the :class:`~PySide.QtGui.QStandardItem` items that are associated with this model.</span>
<span class="sd">        :returns: standard shotgun filter list to represent that item</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># prime filters with our base query</span>
        <span class="n">filters</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__filters</span><span class="p">)</span>

        <span class="c1"># now walk up the tree and get all fields</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">item</span>
        <span class="k">while</span> <span class="n">p</span><span class="p">:</span>
            <span class="n">field_data</span> <span class="o">=</span> <span class="n">get_sanitized_data</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SG_ASSOCIATED_FIELD_ROLE</span><span class="p">)</span>
            <span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">field_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="s2">&quot;is&quot;</span><span class="p">,</span> <span class="n">field_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]])</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">filters</span></div>

<div class="viewcode-block" id="ShotgunModel.ensure_data_is_loaded"><a class="viewcode-back" href="../../shotgun_model.html#shotgun_model.ShotgunModel.ensure_data_is_loaded">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">ensure_data_is_loaded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recursively processes the model and ensures that all data</span>
<span class="sd">        has been loaded into the model.</span>

<span class="sd">        Beginning with v5, the Shotgun model defer loads its data into the model for</span>
<span class="sd">        optimal performance. Normally, this is not an issue - the data is typically</span>
<span class="sd">        requested prior to a user expanding a tree node in a view. In some cases,</span>
<span class="sd">        however, it is necessary to pre-fetch parts of the tree. One example of this</span>
<span class="sd">        is if you want to perform filtering via a</span>
<span class="sd">        :class:`~PySide.QtGui.QSortFilterProxyModel`. Please note that for large</span>
<span class="sd">        data sets, this operation may be slow.</span>

<span class="sd">        .. versionadded:: 5.0.0</span>

<span class="sd">        :param index: Model index for which to recursively load data.</span>
<span class="sd">                      If set to None, the entire tree will be loaded.</span>
<span class="sd">        :type index: :class:`~PySide.QtCore.QModelIndex`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># load everything</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">invisibleRootItem</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">canFetchMore</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fetchMore</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">child_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="p">(</span><span class="n">index</span><span class="p">)):</span>
            <span class="n">child_model_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ensure_data_is_loaded</span><span class="p">(</span><span class="n">child_model_index</span><span class="p">)</span></div>

<div class="viewcode-block" id="ShotgunModel.get_entity_type"><a class="viewcode-back" href="../../shotgun_model.html#shotgun_model.ShotgunModel.get_entity_type">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_entity_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the Shotgun Entity type associated with this model.</span>

<span class="sd">        :returns: Shotgun entity type string (e.g. &#39;Shot&#39;, &#39;Asset&#39; etc).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__entity_type</span></div>

<div class="viewcode-block" id="ShotgunModel.get_additional_column_fields"><a class="viewcode-back" href="../../shotgun_model.html#shotgun_model.ShotgunModel.get_additional_column_fields">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_additional_column_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the fields for additional columns and their associated column in the model.</span>

<span class="sd">        :returns: A list of dictionaries with the following keys:</span>
<span class="sd">            &quot;field&quot;: the requested additional field for the column</span>
<span class="sd">            &quot;column_idx&quot;: the column number in the model associated with the additional field</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># column is one greater than the index because of the default initial column</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;column_idx&quot;</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="n">field</span><span class="p">}</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__column_fields</span><span class="p">)</span>
        <span class="p">]</span></div>

    <span class="c1">########################################################################################</span>
    <span class="c1"># protected methods</span>

<div class="viewcode-block" id="ShotgunModel._load_data"><a class="viewcode-back" href="../../shotgun_model.html#shotgun_model.ShotgunModel._load_data">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">_load_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">entity_type</span><span class="p">,</span>
        <span class="n">filters</span><span class="p">,</span>
        <span class="n">hierarchy</span><span class="p">,</span>
        <span class="n">fields</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">additional_filter_presets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">editable_columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is the main method to use to configure the model. You basically</span>
<span class="sd">        pass a specific find query to the model and it will start tracking</span>
<span class="sd">        this particular set of filter and hierarchy parameters.</span>

<span class="sd">        Any existing data contained in the model will be cleared.</span>

<span class="sd">        This method will not call the Shotgun API. If cached data is available,</span>
<span class="sd">        this will be immediately loaded (this operation is very fast even for</span>
<span class="sd">        substantial amounts of data).</span>

<span class="sd">        If you want to refresh the data contained in the model (which you typically</span>
<span class="sd">        want to), call the :meth:`_refresh_data()` method.</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            # Example call from a subclass of ShotgunModel that displays assets.</span>
<span class="sd">            # Additional &quot;code&quot; and &quot; description&quot; columns will be displayed,</span>
<span class="sd">            # and the &quot;description&quot; column will be editable.</span>
<span class="sd">            self._load_data(</span>
<span class="sd">                &quot;Asset&quot;,                            # entity_type</span>
<span class="sd">                [],                                 # filters</span>
<span class="sd">                [&quot;sg_asset_type&quot;, &quot;code&quot;],          # hierarchy</span>
<span class="sd">                [&quot;description&quot;],                    # fields</span>
<span class="sd">                columns=[&quot;code&quot;, &quot;description&quot;],    # additional columns to display</span>
<span class="sd">                editable_columns=[&quot;description&quot;],</span>
<span class="sd">            )</span>

<span class="sd">        :param entity_type:               Shotgun entity type to download</span>
<span class="sd">        :param filters:                   List of Shotgun filters. Standard Shotgun syntax. Passing None instead</span>
<span class="sd">                                          of a list of filters indicates that no shotgun data should be retrieved</span>
<span class="sd">                                          and no API calls will be made.</span>
<span class="sd">        :param hierarchy:                 List of grouping fields. These should be names of Shotgun</span>
<span class="sd">                                          fields. If you for example want to create a list of items,</span>
<span class="sd">                                          the value ``[&quot;code&quot;]`` will be suitable. This will generate a data</span>
<span class="sd">                                          model which is flat and where each item&#39;s default name is the</span>
<span class="sd">                                          Shotgun name field. If you want to generate a tree where assets</span>
<span class="sd">                                          are broken down by asset type, you could instead specify</span>
<span class="sd">                                          ``[&quot;sg_asset_type&quot;, &quot;code&quot;]``.</span>
<span class="sd">        :param fields:                    Fields to retrieve from Shotgun (in addition to the ones specified</span>
<span class="sd">                                          in the hierarchy parameter). Standard Shotgun API syntax. If you</span>
<span class="sd">                                          specify None for this parameter, Shotgun will not be called when</span>
<span class="sd">                                          the _refresh_data() method is being executed.</span>
<span class="sd">        :param order:                     Order clause for the Shotgun data. Standard Shotgun API syntax.</span>
<span class="sd">                                          Note that this is an advanced parameter which is meant to be used</span>
<span class="sd">                                          in subclassing only. The model itself will be ordered by its</span>
<span class="sd">                                          default display name, and if any other type of ordering is desirable,</span>
<span class="sd">                                          use for example a QProxyModel to handle this. However, knowing in which</span>
<span class="sd">                                          order results will arrive from Shotgun can be beneficial if you are doing</span>
<span class="sd">                                          grouping, deferred loading and aggregation of data as part of your</span>
<span class="sd">                                          subclassed implementation, typically via the :meth:`_before_data_processing()` method.</span>
<span class="sd">        :param seed:                      Advanced parameter. With each shotgun query being cached on disk, the model</span>
<span class="sd">                                          generates a cache seed which it is using to store data on disk. Since the cache</span>
<span class="sd">                                          data on disk is a reflection of a particular shotgun query, this seed is typically</span>
<span class="sd">                                          generated from the various query and field parameters passed to this method. However,</span>
<span class="sd">                                          in some cases when you are doing advanced subclassing, for example when you are culling</span>
<span class="sd">                                          out data based on some external state, the model state does not solely depend on the</span>
<span class="sd">                                          shotgun query parameters. It may also depend on some external factors. In this case,</span>
<span class="sd">                                          the cache seed should also be influenced by those parameters and you can pass</span>
<span class="sd">                                          an external string via this parameter which will be added to the seed.</span>
<span class="sd">        :param limit:                     Limit the number of results returned from Shotgun. In conjunction with the order</span>
<span class="sd">                                          parameter, this can be used to effectively cap the data set that the model</span>
<span class="sd">                                          is handling, allowing a user to for example show the twenty most recent notes or</span>
<span class="sd">                                          similar.</span>
<span class="sd">        :param list columns:              If columns is specified, then any leaf row in the model will have columns created where</span>
<span class="sd">                                          each column in the row contains the value for the corresponding field from columns. This means</span>
<span class="sd">                                          that the data from the loaded entity will be available field by field. Subclasses can modify</span>
<span class="sd">                                          this behavior by overriding _get_additional_columns.</span>
<span class="sd">        :param additional_filter_presets: List of Shotgun filter presets to apply, e.g.</span>
<span class="sd">                                          ``[{&quot;preset_name&quot;:&quot;LATEST&quot;,&quot;latest_by&quot;:&quot;BY_PIPELINE_STEP_NUMBER_AND_ENTITIES_CREATED_AT&quot;}]``</span>
<span class="sd">        :param list editable_columns:     A subset of ``columns`` that will be editable in views that use this model.</span>

<span class="sd">        :returns:                         True if cached data was loaded, False if not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># we are changing the query</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_changed</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

        <span class="c1"># clear out old data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__entity_type</span> <span class="o">=</span> <span class="n">entity_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__filters</span> <span class="o">=</span> <span class="n">filters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__fields</span> <span class="o">=</span> <span class="n">fields</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__order</span> <span class="o">=</span> <span class="n">order</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__hierarchy</span> <span class="o">=</span> <span class="n">hierarchy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__column_fields</span> <span class="o">=</span> <span class="n">columns</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__editable_fields</span> <span class="o">=</span> <span class="n">editable_columns</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__limit</span> <span class="o">=</span> <span class="n">limit</span> <span class="ow">or</span> <span class="mi">0</span>  <span class="c1"># 0 means get all matches</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__additional_filter_presets</span> <span class="o">=</span> <span class="n">additional_filter_presets</span>

        <span class="c1"># make sure `editable_fields` is a subset of `column_fields`</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__editable_fields</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__column_fields</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">sgtk</span><span class="o">.</span><span class="n">TankError</span><span class="p">(</span>
                <span class="s2">&quot;The `editable_fields` argument is not a subset of &quot;</span> <span class="s2">&quot;`column_fields`.&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log_debug</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_debug</span><span class="p">(</span><span class="s2">&quot;Model Reset for </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_debug</span><span class="p">(</span><span class="s2">&quot;Entity type: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__entity_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_debug</span><span class="p">(</span><span class="s2">&quot;Filters: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__filters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_debug</span><span class="p">(</span><span class="s2">&quot;Hierarchy: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hierarchy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_debug</span><span class="p">(</span><span class="s2">&quot;Fields: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__fields</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_debug</span><span class="p">(</span><span class="s2">&quot;Order: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__order</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_debug</span><span class="p">(</span><span class="s2">&quot;Columns: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__column_fields</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_debug</span><span class="p">(</span><span class="s2">&quot;Editable Columns: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__editable_fields</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_debug</span><span class="p">(</span><span class="s2">&quot;Filter Presets: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__additional_filter_presets</span><span class="p">)</span>

        <span class="c1"># get the cache path based on these new data query parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_handler</span> <span class="o">=</span> <span class="n">ShotgunFindDataHandler</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__entity_type</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__filters</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__order</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__hierarchy</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__fields</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__column_fields</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__download_thumbs</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__limit</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__additional_filter_presets</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__compute_cache_path</span><span class="p">(</span><span class="n">seed</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="c1"># load up from disk</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_debug</span><span class="p">(</span><span class="s2">&quot;Loading data from cache file into memory...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_handler</span><span class="o">.</span><span class="n">load_cache</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log_debug</span><span class="p">(</span><span class="s2">&quot;First population pass: Calling _load_external_data()&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_external_data</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_debug</span><span class="p">(</span><span class="s2">&quot;External data population done.&quot;</span><span class="p">)</span>

        <span class="c1"># set our headers</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">FIRST_COLUMN_HEADER</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_additional_column_headers</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__entity_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__column_fields</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setHorizontalHeaderLabels</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>

        <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">invisibleRootItem</span><span class="p">()</span>

        <span class="c1"># construct the top level nodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_debug</span><span class="p">(</span><span class="s2">&quot;Creating model nodes for top level of data tree...&quot;</span><span class="p">)</span>
        <span class="n">nodes_generated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_handler</span><span class="o">.</span><span class="n">generate_child_nodes</span><span class="p">(</span>
            <span class="kc">None</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_item</span>
        <span class="p">)</span>

        <span class="c1"># if we got some data, emit cache load signal</span>
        <span class="k">if</span> <span class="n">nodes_generated</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cache_loaded</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

        <span class="c1"># return true if cache is loaded false if not</span>
        <span class="k">return</span> <span class="n">nodes_generated</span> <span class="o">&gt;</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="ShotgunModel._refresh_data"><a class="viewcode-back" href="../../shotgun_model.html#shotgun_model.ShotgunModel._refresh_data">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">_refresh_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rebuilds the data in the model to ensure it is up to date.</span>
<span class="sd">        This call is asynchronous and will return instantly.</span>
<span class="sd">        The update will be applied whenever the data from Shotgun is returned.</span>

<span class="sd">        If the model is empty (no cached data) no data will be shown at first</span>
<span class="sd">        while the model fetches data from Shotgun.</span>

<span class="sd">        As soon as a local cache exists, data is shown straight away and the</span>
<span class="sd">        shotgun update happens silently in the background.</span>

<span class="sd">        If data has been added, this will be injected into the existing structure.</span>
<span class="sd">        In this case, the rest of the model is intact, meaning that also selections</span>
<span class="sd">        and other view related states are unaffected.</span>

<span class="sd">        If data has been modified or deleted, a full rebuild is issued, meaning that</span>
<span class="sd">        all existing items from the model are removed. This does affect view related</span>
<span class="sd">        states such as selection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_request_data</span><span class="p">()</span></div>

<div class="viewcode-block" id="ShotgunModel._item_created"><a class="viewcode-back" href="../../shotgun_model.html#shotgun_model.ShotgunModel._item_created">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">_item_created</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called when an item is created, before it is added to the model.</span>

<span class="sd">        .. warning:: This base class implementation must be called in any</span>
<span class="sd">            subclasses overriding this behavior. Failure to do so will result in</span>
<span class="sd">            unexpected behavior.</span>

<span class="sd">        This base class implementation handles storing item lookups for</span>
<span class="sd">        efficiency as well as to prevent issues with garbage collection.</span>

<span class="sd">        :param item: The item that was just created.</span>
<span class="sd">        :type item: :class:`~PySide.QtGui.QStandardItem`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># as per docs, call the base implementation</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_item_created</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="c1"># request thumbnail for this item</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__download_thumbs</span><span class="p">:</span>
            <span class="n">sg_data</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SG_DATA_ROLE</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">sg_data</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">sg_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="c1"># note: we check for all fields containing &quot;image&quot;</span>
                    <span class="c1"># so that we&#39;ll catch a field such as &#39;sg_sequence.Sequence.image&#39;</span>
                    <span class="c1"># as well as a straight &#39;image&#39; field</span>
                    <span class="k">if</span> <span class="s2">&quot;image&quot;</span> <span class="ow">in</span> <span class="n">field</span> <span class="ow">and</span> <span class="n">sg_data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="c1"># we have a thumb we are supposed to download!</span>
                        <span class="c1"># get the thumbnail - store the unique id we get back from</span>
                        <span class="c1"># the data retrieve in a dict for fast lookup later</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_request_thumbnail_download</span><span class="p">(</span>
                            <span class="n">item</span><span class="p">,</span>
                            <span class="n">field</span><span class="p">,</span>
                            <span class="n">sg_data</span><span class="p">[</span><span class="n">field</span><span class="p">],</span>
                            <span class="n">sg_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">),</span>
                            <span class="n">sg_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">),</span>
                        <span class="p">)</span></div>

<div class="viewcode-block" id="ShotgunModel._set_tooltip"><a class="viewcode-back" href="../../shotgun_model.html#shotgun_model.ShotgunModel._set_tooltip">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">_set_tooltip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">sg_item</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called when an item is created.</span>

<span class="sd">        .. note:: You can subclass this if you want to set your own tooltip for the model item. By</span>
<span class="sd">            default, the SG_ASSOCIATED_FIELD_ROLE data is retrieved and the field name is used to</span>
<span class="sd">            determine which field to pick tooltip information from.</span>

<span class="sd">            For example,</span>

<span class="sd">            .. code-block:: python</span>

<span class="sd">               {</span>
<span class="sd">                   &quot;type&quot;: &quot;Task&quot;,</span>
<span class="sd">                   &quot;entity&quot;: {                       # (1) Tooltip becomes &quot;Asset &#39;Alice&#39;&quot;</span>
<span class="sd">                       &quot;sg_asset_type&quot;: &quot;Character&quot;, # (2) Tooltip becomes &quot;Asset Type &#39;Character&#39;&quot;</span>
<span class="sd">                       &quot;type&quot;: &quot;Asset&quot;,</span>
<span class="sd">                       &quot;code&quot;: &quot;Alice&quot;</span>
<span class="sd">                   },</span>
<span class="sd">                   &quot;content&quot;: &quot;Art&quot;                  # (3) Tooltip becomes &quot;Task &#39;Art&#39;&quot;</span>
<span class="sd">               }</span>

<span class="sd">            1) If the field is an entity (e.g. entity), then the display name of that entity&#39;s type</span>
<span class="sd">            will be used.</span>

<span class="sd">            2) If the field is part of a sub-entity (e.g entity.Asset.sg_asset_type), the display</span>
<span class="sd">            name of the sub-entity&#39;s type followed by a space and the sub-entity&#39;s field display name</span>
<span class="sd">            will be used.</span>

<span class="sd">            3) If the field is part of an entity and not an entity field(e.g. content), the display</span>
<span class="sd">            name of the entity&#39;s type will be used.</span>

<span class="sd">            In all cases, the string ends with the quoted name of the ShotgunStandardItem.</span>

<span class="sd">        :param item: Shotgun model item that requires a tooltip.</span>
<span class="sd">        :param sg_item: Dictionary of the entity associated with the Shotgun model item.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SG_ASSOCIATED_FIELD_ROLE</span><span class="p">)</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sg_item</span><span class="p">[</span><span class="n">field</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;type&quot;</span> <span class="ow">in</span> <span class="n">sg_item</span><span class="p">[</span><span class="n">field</span><span class="p">]:</span>
            <span class="c1"># This is scenario 1 described above.</span>
            <span class="n">item</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span>
                <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_shotgun_globals</span><span class="o">.</span><span class="n">get_type_display_name</span><span class="p">(</span><span class="n">sg_item</span><span class="p">[</span><span class="n">field</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]),</span>
                    <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">field</span><span class="p">:</span>
            <span class="c1"># This is scenario 2 described above. We only want to get the last entity and field.</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">sub_entity_type</span><span class="p">,</span> <span class="n">sub_entity_field_name</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">item</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span>
                <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_shotgun_globals</span><span class="o">.</span><span class="n">get_type_display_name</span><span class="p">(</span><span class="n">sub_entity_type</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_shotgun_globals</span><span class="o">.</span><span class="n">get_field_display_name</span><span class="p">(</span>
                        <span class="n">sub_entity_type</span><span class="p">,</span> <span class="n">sub_entity_field_name</span>
                    <span class="p">),</span>
                    <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># This is scenario 3 described above.</span>
            <span class="n">item</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span>
                <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_shotgun_globals</span><span class="o">.</span><span class="n">get_type_display_name</span><span class="p">(</span><span class="n">sg_item</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]),</span>
                    <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
                <span class="p">)</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="ShotgunModel._get_additional_columns"><a class="viewcode-back" href="../../shotgun_model.html#shotgun_model.ShotgunModel._get_additional_columns">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_additional_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">primary_item</span><span class="p">,</span> <span class="n">is_leaf</span><span class="p">,</span> <span class="n">columns</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called when an item is about to be inserted into the model, to get additional items</span>
<span class="sd">        to be included in the same row as the specified item. This provides an opportunity</span>
<span class="sd">        for subclasses to create one or more additional columns for each item in the model.</span>

<span class="sd">        Note that this method is always called before inserting an item, even when loading</span>
<span class="sd">        from the cache. Any data that is expensive to compute or query should be added</span>
<span class="sd">        to the ShotgunStandardItem in _populate_item, since column data is not cached.</span>
<span class="sd">        Also note that item population methods (_populate_item, _populate_thumbnail, etc)</span>
<span class="sd">        will not be called on the return columns.</span>

<span class="sd">        This method should return a list of QStandardItems, one for each additional column.</span>
<span class="sd">        The original ShotgunStandardItem is always the first item in each row and should</span>
<span class="sd">        NOT be included in the returned list. Any empty value returned by this method</span>
<span class="sd">        is guaranteed to be treated as an empty list (i.e. you may return None).</span>

<span class="sd">        This method is called after _finalize_item.</span>

<span class="sd">        :param primary_item: :class:`~PySide.QtGui.QStandardItem` that is about to be added to the model</span>
<span class="sd">        :param is_leaf: boolean that is True if the item is a leaf item</span>
<span class="sd">        :param columns: list of Shotgun field names requested as the columns from _load_data</span>

<span class="sd">        :returns: list of :class:`~PySide.QtGui.QStandardItem`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># default implementation will create items for the given fields from the item if it is a leaf</span>
        <span class="c1"># with the display role being the string value for the field and the actual data value in</span>
        <span class="c1"># SG_ASSOCIATED_FIELD_ROLE</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">is_leaf</span> <span class="ow">and</span> <span class="n">columns</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">get_sg_data</span><span class="p">(</span><span class="n">primary_item</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
                <span class="c1"># set the display role to the string representation of the value</span>
                <span class="n">column_item</span> <span class="o">=</span> <span class="n">ShotgunStandardItem</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__generate_display_name</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">column_item</span><span class="o">.</span><span class="n">setEditable</span><span class="p">(</span><span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__editable_fields</span><span class="p">)</span>

                <span class="c1"># set associated field role to be the column value itself</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
                <span class="n">column_item</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span>
                    <span class="n">sanitize_for_qt_model</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">SG_ASSOCIATED_FIELD_ROLE</span>
                <span class="p">)</span>

                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">column_item</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">items</span></div>

<div class="viewcode-block" id="ShotgunModel._get_additional_column_headers"><a class="viewcode-back" href="../../shotgun_model.html#shotgun_model.ShotgunModel._get_additional_column_headers">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_additional_column_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">columns</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called to set the headers for the additional columns requested from _load_data.</span>

<span class="sd">        :param entity_type: type name of the entity the columns are for</span>
<span class="sd">        :param columns: list of Shotgun field names requested as the columns from _load_data</span>

<span class="sd">        :returns: list of strings to use as the headers</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># default implementation will set the headers to the display names for the fields</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_shotgun_globals</span><span class="o">.</span><span class="n">get_field_display_name</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">columns</span>
        <span class="p">]</span></div>

<div class="viewcode-block" id="ShotgunModel._get_columns"><a class="viewcode-back" href="../../shotgun_model.html#shotgun_model.ShotgunModel._get_columns">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">is_leaf</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a row (list of QStandardItems) given an initial QStandardItem.  The item itself</span>
<span class="sd">        is always the first item in the row, but additional columns may be appended.</span>

<span class="sd">        :param item: A :class:`~PySide.QtGui.QStandardItem` that is associated with this model.</span>
<span class="sd">        :param is_leaf: A boolean indicating if the item is a leaf item or not</span>

<span class="sd">        :returns: A list of :class:`~PySide.QtGui.QStandardItem` s</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># the first item in the row is always the standard shotgun model item,</span>
        <span class="c1"># but subclasses may provide additional columns to be appended.</span>
        <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="p">]</span>
        <span class="n">row</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_additional_columns</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">is_leaf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__column_fields</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">row</span></div>

    <span class="k">def</span><span class="w"> </span><span class="nf">_create_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">data_item</span><span class="p">,</span> <span class="n">top_index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a model item for the tree given data out of the data store</span>

<span class="sd">        :param :class:`~PySide.QtGui.QStandardItem` parent: Model item to parent the node under</span>
<span class="sd">        :param :class:`ShotgunItemData` data_item: Data to populate new item with</span>
<span class="sd">        :param int top_index: Indicates an index the item should be placed on the tree</span>

<span class="sd">        :returns: Model item</span>
<span class="sd">        :rtype: :class:`ShotgunStandardItem`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># construct tree view node object</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">ShotgunStandardItem</span><span class="p">()</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setEditable</span><span class="p">(</span><span class="n">data_item</span><span class="o">.</span><span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__editable_fields</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_item</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">data_item</span><span class="p">)</span>

        <span class="c1"># run the finalizer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_finalize_item</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="c1"># get complete row containing all columns for the current item</span>
        <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_columns</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">data_item</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">())</span>

        <span class="c1"># and attach the node</span>
        <span class="k">if</span> <span class="n">top_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">insertRow</span><span class="p">(</span><span class="n">top_index</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">appendRow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">item</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_update_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">data_item</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates a model item with the given data</span>

<span class="sd">        :param :class:`~PySide.QtGui.QStandardItem` item: Model item to update</span>
<span class="sd">        :param :class:`ShotgunItemData` data_item: Data to update item with</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">field_display_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__generate_display_name</span><span class="p">(</span>
            <span class="n">data_item</span><span class="o">.</span><span class="n">field</span><span class="p">,</span> <span class="n">data_item</span><span class="o">.</span><span class="n">shotgun_data</span>
        <span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">field_display_name</span><span class="p">)</span>

        <span class="c1"># keep tabs of which items we are creating</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">IS_SG_MODEL_ROLE</span><span class="p">)</span>

        <span class="c1"># flag if item has children, for the fetchMore functionality</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="ow">not</span> <span class="n">data_item</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SG_ITEM_HAS_CHILDREN</span><span class="p">)</span>

        <span class="c1"># transfer a unique id from the data backend so we can</span>
        <span class="c1"># refer back to this node later on</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">data_item</span><span class="o">.</span><span class="n">unique_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SG_ITEM_UNIQUE_ID</span><span class="p">)</span>

        <span class="c1"># store the actual value we have</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">data_item</span><span class="o">.</span><span class="n">field</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">data_item</span><span class="o">.</span><span class="n">shotgun_data</span><span class="p">[</span><span class="n">data_item</span><span class="o">.</span><span class="n">field</span><span class="p">]},</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SG_ASSOCIATED_FIELD_ROLE</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">data_item</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">():</span>
            <span class="c1"># this is the leaf level!</span>
            <span class="c1"># attach the shotgun data so that we can access it later</span>
            <span class="c1"># note: Qt automatically changes everything to be unicode</span>
            <span class="c1"># according to strange rules of its own, so force convert</span>
            <span class="c1"># all shotgun values to be proper unicode prior to setData</span>
            <span class="n">item</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span>
                <span class="n">sanitize_for_qt_model</span><span class="p">(</span><span class="n">data_item</span><span class="o">.</span><span class="n">shotgun_data</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">SG_DATA_ROLE</span>
            <span class="p">)</span>

        <span class="c1"># Now we got the object set up. Now start calling custom methods:</span>

        <span class="c1"># allow item customization prior to adding to model</span>
        <span class="c1"># note: this now runs both on update and create, which may be</span>
        <span class="c1">#       conceptually confusing.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_item_created</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="c1"># set up default thumb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_populate_default_thumbnail</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="c1"># run the populate item method</span>
        <span class="k">if</span> <span class="n">data_item</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_populate_item</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">data_item</span><span class="o">.</span><span class="n">shotgun_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_populate_item</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_tooltip</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">data_item</span><span class="o">.</span><span class="n">shotgun_data</span><span class="p">)</span>

    <span class="c1">########################################################################################</span>
    <span class="c1"># private methods</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__compute_cache_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cache_seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates and returns a cache path to use for this instance&#39;s query.</span>

<span class="sd">        :param cache_seed: Cache seed supplied to the ``__init__`` method.</span>

<span class="sd">        :return: The path to use when caching the model data.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># when we cache the data associated with this model, create</span>
        <span class="c1"># the file name and path based on several parameters.</span>
        <span class="c1"># the path will be on the form CACHE_LOCATION/cached_sg_queries/EntityType/params_hash/filter_hash</span>
        <span class="c1">#</span>
        <span class="c1"># params_hash is an md5 hash representing all parameters going into a particular</span>
        <span class="c1"># query setup and filters_hash is an md5 hash of the filter conditions.</span>
        <span class="c1">#</span>
        <span class="c1"># the reason these are split up is because the params tend to be constant and</span>
        <span class="c1"># the filters keep varying depending on user input.</span>
        <span class="c1">#</span>
        <span class="c1"># some comment regarding the fields that make up the hash</span>
        <span class="c1">#</span>
        <span class="c1"># fields, order, hierarchy are all coming from Shotgun</span>
        <span class="c1"># and are used to uniquely identify the cache file. Typically,</span>
        <span class="c1"># code using the shotgun model will keep these fields constant</span>
        <span class="c1"># while varying filters. With the filters hashed separately,</span>
        <span class="c1"># this typically generates a folder structure where there is one</span>
        <span class="c1"># top level folder containing a series of cache files</span>
        <span class="c1"># all for different filters.</span>
        <span class="c1">#</span>
        <span class="c1"># the schema generation is used for advanced implementations</span>
        <span class="c1"># See constructor docstring for details.</span>
        <span class="c1">#</span>
        <span class="c1"># bg_load_thumbs is hashed so that the system can cache</span>
        <span class="c1"># thumb and non-thumb caches independently. This is because</span>
        <span class="c1"># as soon as you start caching thumbnails, qpixmap will be used</span>
        <span class="c1"># internally by the serialization and this means that you get</span>
        <span class="c1"># warnings if you try to use those caches in threads. By keeping</span>
        <span class="c1"># caches separate, there is no risk that a thumb cache &#39;pollutes&#39;</span>
        <span class="c1"># a non-thumb cache.</span>
        <span class="c1">#</span>
        <span class="c1"># now hash up the rest of the parameters and make that the filename</span>
        <span class="n">params_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>

        <span class="c1"># FIXME: Python 2 and Python 3 order values differently in a dictionary,</span>
        <span class="c1"># which means that their string representation are going to differ</span>
        <span class="c1"># between Python versions</span>
        <span class="c1">#</span>
        <span class="c1"># As users are going to be drifting between Python 2 and Python 3 for a</span>
        <span class="c1"># while, a fully deterministic way of generating the cache name should</span>
        <span class="c1"># be implemented.</span>
        <span class="c1">#</span>
        <span class="c1"># A simple approach would be to encode the data in a JSON structured</span>
        <span class="c1"># with ordered keys and then having the text representation of that data.</span>
        <span class="n">params_hash</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">sgutils</span><span class="o">.</span><span class="n">ensure_binary</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__schema_generation</span><span class="p">)))</span>
        <span class="n">params_hash</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">sgutils</span><span class="o">.</span><span class="n">ensure_binary</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__fields</span><span class="p">)))</span>
        <span class="n">params_hash</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">sgutils</span><span class="o">.</span><span class="n">ensure_binary</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__order</span><span class="p">)))</span>
        <span class="n">params_hash</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">sgutils</span><span class="o">.</span><span class="n">ensure_binary</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__hierarchy</span><span class="p">)))</span>
        <span class="c1"># If this value changes over time (like between Qt4 and Qt5), we need to</span>
        <span class="c1"># assume our previous user roles are invalid since Qt might have taken over</span>
        <span class="c1"># it. If role&#39;s value is 32, don&#39;t add it to the hash so we don&#39;t</span>
        <span class="c1"># invalidate PySide/PyQt4 caches.</span>
        <span class="k">if</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">UserRole</span> <span class="o">!=</span> <span class="mi">32</span><span class="p">:</span>
            <span class="n">params_hash</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">sgutils</span><span class="o">.</span><span class="n">ensure_binary</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">UserRole</span><span class="p">)))</span>

        <span class="c1"># now hash up the filter parameters and the seed - these are dynamic</span>
        <span class="c1"># values that tend to change and be data driven, so they are handled</span>
        <span class="c1"># on a different level in the path</span>
        <span class="n">filter_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
        <span class="n">filter_hash</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">sgutils</span><span class="o">.</span><span class="n">ensure_binary</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__filters</span><span class="p">)))</span>
        <span class="n">filter_hash</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">sgutils</span><span class="o">.</span><span class="n">ensure_binary</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__additional_filter_presets</span><span class="p">)))</span>
        <span class="n">params_hash</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">sgutils</span><span class="o">.</span><span class="n">ensure_binary</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cache_seed</span><span class="p">)))</span>

        <span class="c1"># Organize files on disk based on entity type and then filter hash</span>
        <span class="c1"># keep extension names etc short in order to stay away from MAX_PATH</span>
        <span class="c1"># on windows.</span>
        <span class="c1"># Try to share the cache at the site level which was introduced in tk-core</span>
        <span class="c1"># &gt; 0.18.118.</span>
        <span class="c1"># If not available, fallback on per project/pipeline config/plugin id</span>
        <span class="c1"># caching.</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bundle</span><span class="p">,</span> <span class="s2">&quot;site_cache_location&quot;</span><span class="p">):</span>
            <span class="n">cache_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bundle</span><span class="o">.</span><span class="n">site_cache_location</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cache_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bundle</span><span class="o">.</span><span class="n">cache_location</span>
        <span class="n">data_cache_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">cache_location</span><span class="p">,</span>
            <span class="s2">&quot;sg&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__entity_type</span><span class="p">,</span>
            <span class="n">params_hash</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">(),</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filter_hash</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">(),</span> <span class="n">ShotgunFindDataHandler</span><span class="o">.</span><span class="n">FORMAT_VERSION</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">sgtk</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">is_windows</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_cache_path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">250</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_warning</span><span class="p">(</span>
                <span class="s2">&quot;Flow Production Tracking model data cache file path may be affected by windows &quot;</span>
                <span class="s2">&quot;windows MAX_PATH limitation.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">data_cache_path</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__generate_display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">sg_data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a name from a shotgun field.</span>
<span class="sd">        For non-nested structures, this is typically just &quot;code&quot;.</span>
<span class="sd">        For nested structures it can either be something like sg_sequence</span>
<span class="sd">        or something like sg_asset_type.</span>

<span class="sd">        :params field: field name to generate name from</span>
<span class="sd">        :params sg_data: sg data dictionary, straight from shotgun, no unicode, all UTF-8</span>
<span class="sd">        :returns: name string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">sg_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;name&quot;</span> <span class="ow">in</span> <span class="n">value</span> <span class="ow">and</span> <span class="s2">&quot;type&quot;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Unnamed&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">value</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="c1"># this is a list of some sort. Loop over all elements and extrat a comma separated list.</span>
            <span class="n">formatted_values</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># no items in list</span>
                <span class="n">formatted_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;No Value&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;name&quot;</span> <span class="ow">in</span> <span class="n">v</span> <span class="ow">and</span> <span class="s2">&quot;type&quot;</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                    <span class="c1"># This is a link field</span>
                    <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">):</span>
                        <span class="n">formatted_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">formatted_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>

            <span class="k">return</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">formatted_values</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Unnamed&quot;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># everything else just cast to string</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Autodesk.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 

  <script type="text/javascript">
    window.wafCCPAForceShow = true;
    (function(a,b,c,d){
      a='https://tags.tiqcdn.com/utag/autodesk/micro-basic/prod/utag.js';
      b=document;c='script';d=b.createElement(c);d.src=a;d.type='text/java'+c;d.async=true;
      a=b.getElementsByTagName(c)[0];a.parentNode.insertBefore(d,a);
    })();
  </script>


</body>
</html>